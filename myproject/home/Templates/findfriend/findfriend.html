{% extends 'base/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'findfriend/style.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="header">
    <h1>K·∫øt qu·∫£ t√¨m ki·∫øm cho: "{{ keyword }}"</h1>
  </div>

  {% if keyword %}
    {% if results %}
      <div class="friends-list">
        {% for user, mutual, friendship_status, friendship_sender_id in results %}
        <div class="friend-item">
          <div class="friend-left">
            {% if user.avatar %}
              <a href="{% url 'personal_with_id' user.id %}" style="text-decoration:none;color:white">
              <img src="{{ user.avatar.url }}" alt="{{ user.full_name }}" class="avatar">
              </a>
            {% else %}
              <a href="{% url 'personal_with_id' user.id %}" style="text-decoration:none;color:white">
              <div class="avatar">{{ user.full_name|slice:":1" }}</div>
              </a>
            {% endif %}
            <div class="friend-info">
              <a href="{% url 'personal_with_id' user.id %}" style="text-decoration:none;color:white">
              <h3>{{ user.full_name }}</h3>
              </a>
              <p>{{ mutual }} b·∫°n chung</p>
            </div>
          </div>
      
          <div class="friend-actions">
            {% if friendship_status == None %}
            <form method="post" action="{% url 'add_friend' user.id %}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <button class="add-friend-btn">Th√™m b·∫°n b√®</button>
            </form>
      
            {% elif friendship_status == "pending" %}
              {% if friendship_sender_id == current_user.id %}
              <form method="post" action="{% url 'cancel_request' user.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button class="btn btn-warning">‚ùå H·ªßy l·ªùi m·ªùi</button>
              </form>
              {% else %}
              <form method="post" action="{% url 'accept_request' user.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button class="btn btn-success">‚úÖ ƒê·ªìng √Ω</button>
              </form>
              <form method="post" action="{% url 'cancel_request' user.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button class="btn btn-danger">‚ùå T·ª´ ch·ªëi</button>
              </form>
              {% endif %}
      
            {% elif friendship_status == "accepted" %}
              <form method="post" action="{% url 'delete_friend' user.id %}">
                {% csrf_token %}
                <button class="btn btn-danger">‚ùå H·ªßy k·∫øt b·∫°n</button>
              </form>
            {% endif %}
      
            <!-- lu√¥n c√≥ n√∫t nh·∫Øn tin -->
            <button class="add-friend-btn" onclick="sendMessage('{{ user.id }}')">üí¨ Nh·∫Øn tin</button>
          </div>
        </div>
      {% endfor %}
      
      </div>
    {% else %}
      <div class="no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o cho "{{ keyword }}"</div>
    {% endif %}
  {% else %}
    <div class="no-results">Vui l√≤ng nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ t√¨m ki·∫øm b·∫°n b√®.</div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'findfriend/script.js' %}" defer></script>
{% endblock %}
